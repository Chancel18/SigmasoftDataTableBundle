{# 
  SigmasoftDataTableBundle - Modular DataTable Template
  
  Cette template est conçue pour être facilement personnalisable via des blocks Twig.
  Chaque partie peut être surchargée individuellement dans vos propres templates.
  
  Usage:
  {{ component('sigmasoft_datatable', { configuration: datatableConfig }) }}
  
  Pour personnaliser:
  {% extends '@SigmasoftDataTable/datatable.html.twig' %}
  {% block datatable_search %}
      {# Votre propre implémentation de la recherche #}
  {% endblock %}
#}

{% set config = this.getConfiguration() %}
{% set data = this.getData() %}
{% set theme = config.getTheme()|default('bootstrap5') %}

{# Conteneur principal avec classes personnalisables #}
<div{{ attributes.defaults({
    'class': 'sigmasoft-datatable sigmasoft-datatable--' ~ theme,
    'data-entity': config.getEntityClass()|split('\\')|last|lower
}) }}>
    
    {% block datatable_wrapper %}
        {# Structure wrapper personnalisable selon le thème #}
        {% if theme == 'bootstrap5' %}
            <div class="card shadow-sm border-0 rounded-3">
                {% block datatable_header_wrapper %}
                    {% if block('datatable_header') is defined or config.isSearchEnabled() or config.isPaginationEnabled() %}
                        <div class="card-header bg-transparent border-0 p-3">
                            {% block datatable_header %}
                                {{ block('datatable_toolbar') }}
                            {% endblock %}
                        </div>
                    {% endif %}
                {% endblock %}

                {% block datatable_body_wrapper %}
                    <div class="card-body p-0">
                        {% block datatable_alerts %}
                            {{ include('@SigmasoftDataTable/components/_alerts.html.twig') }}
                        {% endblock %}
                        
                        {% block datatable_content %}
                            {{ block('datatable_table') }}
                        {% endblock %}
                    </div>
                {% endblock %}

                {% block datatable_footer_wrapper %}
                    {% if config.isPaginationEnabled() %}
                        <div class="card-footer bg-transparent border-0 p-3">
                            {% block datatable_footer %}
                                {{ block('datatable_pagination') }}
                            {% endblock %}
                        </div>
                    {% endif %}
                {% endblock %}
            </div>
        {% else %}
            {# Structure simple pour autres thèmes #}
            {% block datatable_header %}
                {{ block('datatable_toolbar') }}
            {% endblock %}
            
            {% block datatable_content %}
                {{ block('datatable_table') }}
            {% endblock %}
            
            {% block datatable_footer %}
                {{ block('datatable_pagination') }}
            {% endblock %}
        {% endif %}
    {% endblock %}

    {# Toolbar avec recherche et contrôles #}
    {% block datatable_toolbar %}
        <div class="datatable-toolbar d-flex justify-content-between align-items-center flex-wrap gap-3">
            {% block datatable_toolbar_start %}
                <div class="datatable-toolbar__start d-flex align-items-center gap-3">
                    {% block datatable_search %}
                        {% if config.isSearchEnabled() %}
                            {{ include('@SigmasoftDataTable/components/_search.html.twig') }}
                        {% endif %}
                    {% endblock %}
                    
                    {% block datatable_filters %}
                        {# Emplacement pour des filtres personnalisés #}
                    {% endblock %}
                </div>
            {% endblock %}

            {% block datatable_toolbar_end %}
                <div class="datatable-toolbar__end d-flex align-items-center gap-3">
                    {% block datatable_actions %}
                        {# Emplacement pour des actions globales (export, etc.) #}
                    {% endblock %}
                    
                    {% block datatable_items_per_page %}
                        {% if config.isPaginationEnabled() %}
                            {{ include('@SigmasoftDataTable/components/_items_per_page.html.twig') }}
                        {% endif %}
                    {% endblock %}
                </div>
            {% endblock %}
        </div>
    {% endblock %}

    {# Table principale #}
    {% block datatable_table %}
        <div class="table-responsive">
            <table class="{{ block('datatable_table_classes') }}" 
                   data-loading="addClass(opacity-50)">
                {% block datatable_thead %}
                    <thead class="{{ block('datatable_thead_classes') }}">
                        <tr>
                            {% block datatable_headers %}
                                {% for column in config.getColumns() %}
                                    {% block datatable_header_cell %}
                                        {{ include('@SigmasoftDataTable/components/_header_cell.html.twig', {
                                            'column': column,
                                            'config': config,
                                            'sortField': this.config.sortField,
                                            'sortDirection': this.config.sortDirection
                                        }) }}
                                    {% endblock %}
                                {% endfor %}
                            {% endblock %}
                        </tr>
                    </thead>
                {% endblock %}

                {% block datatable_tbody %}
                    <tbody class="{{ block('datatable_tbody_classes') }}">
                        {% block datatable_rows %}
                            {% for item in data %}
                                {% block datatable_row %}
                                    <tr class="{{ block('datatable_row_classes') }}" 
                                        data-id="{{ attribute(item, 'id')|default('') }}">
                                        {% block datatable_cells %}
                                            {% for column in config.getColumns() %}
                                                {% block datatable_cell %}
                                                    {{ include('@SigmasoftDataTable/components/_body_cell.html.twig', {
                                                        'column': column,
                                                        'item': item,
                                                        'component': this
                                                    }) }}
                                                {% endblock %}
                                            {% endfor %}
                                        {% endblock %}
                                    </tr>
                                {% endblock %}
                            {% else %}
                                {% block datatable_empty %}
                                    <tr>
                                        <td colspan="{{ config.getColumns()|length }}" 
                                            class="text-center text-muted py-5">
                                            {% block datatable_empty_content %}
                                                <div class="datatable-empty">
                                                    <i class="bi bi-inbox fs-1 d-block mb-3 opacity-50"></i>
                                                    <p class="mb-1">{{ 'datatable.no_data'|trans({}, 'SigmasoftDataTable') }}</p>
                                                    {% if this.config.searchQuery %}
                                                        <small class="text-muted">
                                                            {{ 'datatable.no_results_for'|trans({'%search%': this.config.searchQuery}, 'SigmasoftDataTable') }}
                                                        </small>
                                                    {% endif %}
                                                </div>
                                            {% endblock %}
                                        </td>
                                    </tr>
                                {% endblock %}
                            {% endfor %}
                        {% endblock %}
                    </tbody>
                {% endblock %}

                {% block datatable_tfoot %}
                    {# Optionnel : pied de table pour totaux, etc. #}
                {% endblock %}
            </table>
        </div>
    {% endblock %}

    {# Pagination #}
    {% block datatable_pagination %}
        {% if config.isPaginationEnabled() and data.getPageCount() > 1 %}
            {{ include('@SigmasoftDataTable/components/_pagination.html.twig', {
                'data': data
            }) }}
        {% endif %}
    {% endblock %}

    {# Styles personnalisables #}
    {% block datatable_styles %}
        <style>
            {% block datatable_custom_styles %}
                .sigmasoft-datatable {
                    {% block datatable_container_styles %}
                    {% endblock %}
                }

                .sigmasoft-datatable .sortable-header {
                    cursor: pointer;
                    user-select: none;
                }

                .sigmasoft-datatable .sort-button {
                    transition: color 0.2s ease;
                }

                .sigmasoft-datatable [data-loading] {
                    transition: opacity 0.2s ease;
                }

                {% block datatable_theme_styles %}
                    {% if theme == 'bootstrap5' %}
                        .sigmasoft-datatable--bootstrap5 .sort-button {
                            color: var(--bs-gray-600);
                            border: none;
                            background: none;
                            padding: 0.25rem;
                        }

                        .sigmasoft-datatable--bootstrap5 .sort-button:hover {
                            color: var(--bs-primary);
                        }

                        .sigmasoft-datatable--bootstrap5 .table > :not(caption) > * > * {
                            vertical-align: middle;
                        }
                    {% endif %}
                {% endblock %}

                {% block datatable_additional_styles %}
                    {# Pour des styles additionnels #}
                {% endblock %}
            {% endblock %}
        </style>
    {% endblock %}

    {# Scripts personnalisables #}
    {% block datatable_scripts %}
        {# Pour des scripts additionnels si nécessaire #}
    {% endblock %}
</div>

{# Définition des classes par défaut - peuvent être surchargées #}
{% block datatable_table_classes %}{{ config.getTableClass() }}{% endblock %}
{% block datatable_thead_classes %}{% endblock %}
{% block datatable_tbody_classes %}{% endblock %}
{% block datatable_row_classes %}{% endblock %}