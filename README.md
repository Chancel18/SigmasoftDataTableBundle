# SigmasoftDataTableBundle (BETA)

[![Latest Stable Version](https://poser.pugx.org/sigmasoft/datatable-bundle/v/stable)](https://packagist.org/packages/sigmasoft/datatable-bundle)
[![License](https://poser.pugx.org/sigmasoft/datatable-bundle/license)](https://packagist.org/packages/sigmasoft/datatable-bundle)
[![PHP Version Require](https://poser.pugx.org/sigmasoft/datatable-bundle/require/php)](https://packagist.org/packages/sigmasoft/datatable-bundle)

> ‚ö†Ô∏è **VERSION BETA 3.0.0** - Cette version est en phase de test. Ne pas utiliser en production.
> 
> üìß Merci de reporter tout probl√®me √† : support@sigmasoft-solution.com

**SigmasoftDataTableBundle** est un bundle Symfony moderne et puissant con√ßu pour cr√©er facilement des tables de donn√©es interactives avec des fonctionnalit√©s avanc√©es de tri, recherche, pagination, √©dition inline et export.

## üéØ Fonctionnalit√©s Principales

### ‚ú® Interface Interactive
- **Tri dynamique** des colonnes avec indicateurs visuels
- **Recherche en temps r√©el** avec filtrage intelligent
- **Pagination** avec navigation intuitive
- **Actions personnalis√©es** (voir, √©diter, supprimer)

### üöÄ √âdition Inline V2 (Nouvelle Architecture)
- **Architecture modulaire** avec s√©paration des responsabilit√©s
- **Renderers personnalis√©s** extensibles (Text, Email, Color, Select, Textarea)
- **Validation robuste** c√¥t√© serveur et client
- **Transactions s√©curis√©es** avec rollback automatique
- **JavaScript ES6** avec debouncing et retry automatique

### üèóÔ∏è Architecture Moderne
- **Symfony UX LiveComponent** pour des interactions fluides
- **Patterns √©prouv√©s** (Builder, Factory, Registry, Strategy)
- **15+ classes sp√©cialis√©es** pour une extensibilit√© maximale
- **Configuration YAML** flexible et puissante

### üõ°Ô∏è S√©curit√© Int√©gr√©e
- **Validation SQL** automatique contre les injections
- **√âchappement HTML** des donn√©es utilisateur
- **Contr√¥le des permissions** par r√¥le et propri√©taire
- **Logging PSR-3** des erreurs et tentatives suspectes

## üÜï Nouveaut√©s v3.0.0-beta

### Configuration YAML Fonctionnelle
- ‚úÖ Prise en compte correcte de la configuration bundle
- ‚úÖ Application automatique des valeurs par d√©faut

### Syst√®me d'√âv√©nements Complet
- ‚úÖ DataTableEvents : PRE_LOAD, POST_LOAD, PRE_QUERY
- ‚úÖ InlineEditEvents : PRE_EDIT, POST_EDIT, EDIT_ERROR

### Templates Refactoris√©s
- ‚úÖ Architecture modulaire avec blocks Twig
- ‚úÖ Support de th√®mes (Bootstrap 5, Minimal, Custom)
- ‚úÖ Composants r√©utilisables

### Support des Colonnes Num√©riques
- ‚úÖ NumberColumn avec formatage localis√©
- ‚úÖ 4 formats : integer, decimal, currency, percentage
- ‚úÖ √âdition inline avec validation

## üì¶ Installation

```bash
composer require sigmasoft/datatable-bundle:v3.0.0-beta.1
```

### Configuration des bundles

Ajoutez le bundle dans `config/bundles.php` :

```php
<?php

return [
    // ...
    Sigmasoft\DataTableBundle\SigmasoftDataTableBundle::class => ['all' => true],
];
```

### Configuration YAML

#### Installation automatique (recommand√©e)

Apr√®s installation du bundle, utilisez la commande d'installation :

```bash
# Vider le cache Symfony d'abord
php bin/console cache:clear

# Installer la configuration
php bin/console sigmasoft:datatable:install-config
```

Si la commande n'est pas trouv√©e, utilisez notre **script de diagnostic** :

```bash
# Script de diagnostic automatique
php vendor/sigmasoft/datatable-bundle/bin/check-installation.php
```

**Ou v√©rifiez manuellement :**

1. **Bundle enregistr√©** dans `config/bundles.php` :
```php
<?php
return [
    // ...
    Sigmasoft\DataTableBundle\SigmasoftDataTableBundle::class => ['all' => true],
];
```

2. **Vider le cache** apr√®s installation :
```bash
php bin/console cache:clear
composer dump-autoload
```

3. **Lister les commandes** pour v√©rifier :
```bash
php bin/console list sigmasoft
```

#### Installation manuelle (alternative)

Si la commande ne fonctionne pas, cr√©ez manuellement le fichier `config/packages/sigmasoft_data_table.yaml` :

```yaml
sigmasoft_data_table:
    defaults:
        items_per_page: 10
        enable_search: true
        enable_pagination: true
        enable_sorting: true
        table_class: 'table table-striped table-hover'
        date_format: 'd/m/Y'
        pagination_sizes: [5, 10, 25, 50, 100]
    templates:
        datatable: '@SigmasoftDataTable/datatable.html.twig'
    caching:
        enabled: false
        ttl: 3600
    maker:
        default_column_types:
            string: 'text'
            integer: 'number'
            decimal: 'number'
            boolean: 'badge'
            datetime: 'date'
        excluded_properties: ['password', 'plainPassword', 'salt', 'token']
        auto_add_actions: true
```

## üöÄ Utilisation Rapide

### 1. G√©n√©ration automatique avec Maker

```bash
php bin/console make:datatable User
```

### 2. Configuration manuelle

```php
<?php
// src/Controller/UserController.php

use Sigmasoft\DataTableBundle\Builder\DataTableBuilder;
use Sigmasoft\DataTableBundle\Service\EditableColumnFactory;

class UserController extends AbstractController
{
    public function __construct(
        private DataTableBuilder $dataTableBuilder,
        private EditableColumnFactory $editableColumnFactory
    ) {}

    #[Route('/users', name: 'app_user_index')]
    public function index(): Response
    {
        $datatableConfig = $this->dataTableBuilder
            ->createDataTable(User::class)
            
            // Colonnes √©ditables avec validation
            ->addColumn(
                $this->editableColumnFactory->text('name', 'name', 'Nom')
                    ->required(true)
                    ->maxLength(100)
            )
            ->addColumn(
                $this->editableColumnFactory->email('email', 'email', 'Email')
                    ->required(true)
            )
            ->addColumn(
                $this->editableColumnFactory->select('status', 'status', 'Statut', [
                    'active' => 'Actif',
                    'inactive' => 'Inactif'
                ])
            )
            ->addColumn(
                $this->editableColumnFactory->number('age', 'age', '√Çge')
                    ->min(18)
                    ->max(100)
            )
            
            // Colonnes de lecture seule
            ->addDateColumn('createdAt', 'createdAt', 'Cr√©√© le')
            ->addBadgeColumn('role', 'roles', 'R√¥le', [
                'ROLE_USER' => 'Utilisateur',
                'ROLE_ADMIN' => 'Admin'
            ])
            
            // Actions personnalis√©es
            ->addActionColumn('actions', 'Actions', [
                'show' => ['route' => 'user_show', 'icon' => 'bi bi-eye'],
                'edit' => ['route' => 'user_edit', 'icon' => 'bi bi-pencil'],
                'delete' => ['route' => 'user_delete', 'icon' => 'bi bi-trash', 'confirm' => true]
            ])
            ->configureSearch(true, ['name', 'email'])
            ->configurePagination(true, 10)
            ->getConfiguration(); // R√©cup√©rer la configuration finale

        return $this->render('user/index.html.twig', [
            'datatableConfig' => $datatableConfig,
        ]);
    }
}
```

### 3. Template Twig

```twig
{# templates/user/index.html.twig #}

{% extends 'base.html.twig' %}

{% block body %}
<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="bi bi-people-fill me-2"></i>
                Liste des Utilisateurs
            </h3>
        </div>
        <div class="card-body" 
             data-update-field-url="{{ path('user_update_field') }}"
             data-bulk-update-url="{{ path('user_bulk_update') }}">
            {{ component('sigmasoft_datatable', {
                configuration: datatableConfig
            }) }}
        </div>
    </div>
</div>
{% endblock %}
```

## üìä Types de Colonnes Disponibles

### Colonnes √âditables (avec EditableColumnFactory)

| Type | Description | Exemple |
|------|-------------|---------|
| **text** | Champ texte avec validation | `->text('name', 'name', 'Nom')->required()->maxLength(100)` |
| **email** | Email avec validation | `->email('email', 'email', 'Email')->required()` |
| **number** | Nombre avec contraintes | `->number('price', 'price', 'Prix')->min(0)->step(0.01)` |
| **select** | Liste d√©roulante | `->select('status', 'status', 'Statut', ['Y' => 'Actif'])` |
| **textarea** | Zone de texte | `->textarea('notes', 'notes', 'Notes')->rows(3)` |
| **color** | S√©lecteur de couleur | `->color('color', 'color', 'Couleur')->showPresets()` |

### Colonnes de Lecture Seule

| Type | Description | Exemple |
|------|-------------|---------|
| **TextColumn** | Texte simple avec formatage | `new TextColumn('name', 'name', 'Nom')` |
| **DateColumn** | Date avec format personnalis√© | `new DateColumn('createdAt', 'createdAt', 'Cr√©√© le')` |
| **BadgeColumn** | Badges color√©s | `new BadgeColumn('status', 'status', 'Statut')` |
| **ActionColumn** | Boutons d'actions | `new ActionColumn($urlGenerator, 'actions', 'Actions')` |

### Exemple Complet E-commerce

```php
$config = $this->dataTableBuilder
    ->createDataTable(Product::class)
    
    // Informations produit √©ditables
    ->addColumn(
        $this->editableColumnFactory->text('name', 'name', 'Nom')
            ->required(true)
            ->minLength(3)
            ->maxLength(100)
    )
    ->addColumn(
        $this->editableColumnFactory->number('price', 'price', 'Prix')
            ->required(true)
            ->min(0.01)
            ->step(0.01)
            ->suffix(' ‚Ç¨')
    )
    ->addColumn(
        $this->editableColumnFactory->select('status', 'status', 'Statut', [
            'active' => 'Actif',
            'inactive' => 'Inactif',
            'out_of_stock' => 'Rupture'
        ])
    )
    ->addColumn(
        $this->editableColumnFactory->color('color', 'color', 'Couleur')
            ->showPresets(true)
    )
    
    // Colonnes informatives
    ->addColumn(new BadgeColumn('category', 'category.name', 'Cat√©gorie'))
    ->addDateColumn('createdAt', 'createdAt', 'Cr√©√© le')
    
    // Actions
    ->addActionColumn('actions', 'Actions', [
        'edit' => ['route' => 'product_edit', 'icon' => 'bi bi-pencil'],
        'delete' => ['route' => 'product_delete', 'icon' => 'bi bi-trash', 'confirm' => true]
    ]);
```

## üé® Renderers Personnalis√©s

### Cr√©er un Renderer Personnalis√©

```php
<?php
// src/Renderer/CustomFieldRenderer.php

namespace App\Renderer;

use Sigmasoft\DataTableBundle\InlineEdit\Renderer\AbstractFieldRenderer;
use Sigmasoft\DataTableBundle\InlineEdit\Configuration\EditableFieldConfiguration;

class CustomFieldRenderer extends AbstractFieldRenderer
{
    public function supports(EditableFieldConfiguration $config): bool
    {
        return $config->getFieldType() === 'custom';
    }

    public function render(
        EditableFieldConfiguration $config,
        mixed $value,
        object $entity,
        string $fieldName
    ): string {
        return sprintf(
            '<input type="text" class="editable-field custom-field" data-field="%s" value="%s" />',
            htmlspecialchars($fieldName),
            htmlspecialchars((string) $value)
        );
    }

    public function getPriority(): int
    {
        return 100;
    }
}
```

Le renderer sera automatiquement enregistr√© gr√¢ce au **Compiler Pass**.

## üìä Export de Donn√©es

```php
// Dans votre contr√¥leur
$config = $this->dataTableBuilder
    ->createDataTable(User::class)
    // ... configuration des colonnes
    ->enableExport(['csv', 'excel']);
```

## üß™ Tests

```bash
# Tests unitaires
./vendor/bin/phpunit

# Tests sp√©cifiques au bundle
./vendor/bin/phpunit tests/

# Avec couverture
./vendor/bin/phpunit --coverage-html coverage/
```

## üìö Documentation Compl√®te

### üåê Documentation en Ligne
**Consultez la documentation compl√®te sur :** [https://chancel18.github.io/SigmasoftDataTableBundle/](https://chancel18.github.io/SigmasoftDataTableBundle/)

### üìñ Guides Principaux

| Guide | Description | Niveau |
|-------|-------------|--------|
| [Types de Colonnes](docs/docs/user-guide/column-types.md) | **Guide complet** de tous les types disponibles | üü¢ D√©butant |
| [√âdition Inline](docs/docs/user-guide/inline-editing.md) | Fonctionnalit√©s d'√©dition en temps r√©el | üü° Interm√©diaire |
| [Configuration YAML](docs/docs/user-guide/configuration.md) | Toutes les options de configuration | üü° Interm√©diaire |
| [Exemples Avanc√©s](docs/docs/examples/advanced-examples.md) | **Cas d'usage** E-commerce, CRM, Dashboard | üî¥ Avanc√© |
| [Renderers Personnalis√©s](docs/docs/developer-guide/custom-renderers.md) | Cr√©er ses propres types de champs | üî¥ Avanc√© |

### üöÄ D√©marrage Rapide
1. **Installation** : `composer require sigmasoft/datatable-bundle`
2. **G√©n√©ration** : `php bin/console make:datatable MyEntity`
3. **Personnalisation** : Consultez le [Guide des Types de Colonnes](docs/docs/user-guide/column-types.md)
- [Configuration avanc√©e](docs/configuration.md)

## üõ†Ô∏è D√©veloppement

### Pr√©requis

- PHP 8.1+
- Symfony 6.4+ ou 7.0+
- Composer
- Node.js (pour les assets)

### Installation pour d√©veloppement

```bash
git clone https://github.com/sigmasoft-solution/datatable-bundle.git
cd datatable-bundle
composer install
```

### Contribution

Les contributions sont les bienvenues ! Merci de :

1. Fork le projet
2. Cr√©er une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit vos changements (`git commit -m 'Add some AmazingFeature'`)
4. Push sur la branche (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## üìã Changelog

### Version 2.0.0 (2025-07-29)
- ‚ú® **Nouvelle architecture** modulaire pour l'√©dition inline
- üé® **Renderers personnalis√©s** extensibles avec Strategy Pattern
- üîí **S√©curit√© renforc√©e** avec validation et transactions
- üì± **Export CSV/Excel** int√©gr√©
- üöÄ **JavaScript ES6** moderne avec retry et debouncing

[Voir le changelog complet](CHANGELOG.md)

## üìÑ License

Ce projet est sous licence MIT - voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

## üë®‚Äçüíª Auteur

**G√©d√©on Makela** - [Sigmasoft Solution](https://sigmasoft-solution.com)
- Email: g.makela@sigmasoft-solution.com
- GitHub: [@gedeonmakela](https://github.com/gedeonmakela)

## üôè Remerciements

- L'√©quipe Symfony pour le framework exceptionnel
- Les contributeurs de Symfony UX pour les composants modernes
- La communaut√© open source PHP

---

‚≠ê **N'h√©sitez pas √† mettre une √©toile si ce bundle vous aide !**
# Force GitHub Pages deployment
